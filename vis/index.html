<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Most Affordable Fitness Foods</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Bebas Neue', sans-serif;
      background: #fff;
      padding: 40px;
    }
    h2 {
      font-size: 35px;
    }
    text {
      text-transform: uppercase;
      font-weight: bold;
      fill: #333;
    }
    .food-label, .median-label {
      text-transform: uppercase;
      font-weight: bold;
      font-size: 28px;
    }
    .line, .tick {
      stroke: #333;
    }
    select {
      margin-bottom: 20px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h2>Most Affordable Fitness Foods</h2>
  <select id="category-select"></select>
  <svg width="1000" height="800"></svg>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    const svg = d3.select("svg");
    const margin = { top: 20, left: 100 };
    const width = svg.attr("width") - margin.left;

    const lineThickness = 4;
    const spacing = 70
    const lineHeightOffset = 0.8 * spacing;  // Offset for median line height

    d3.json("supa_out.json").then(data => {
      const categories = Array.from(new Set(data.map(d => d.Category)));

      const select = d3.select("#category-select");
      select.selectAll("option")
        .data(categories)
        .enter()
        .append("option")
        .text(d => d);

      select.on("change", () => render(select.property("value")));

      render(categories[0]);

      function render(category) {
        svg.selectAll("*").remove();

        const filtered = data.filter(d => d.Category === category)
                              .sort((a, b) => b.Median - a.Median);
        const xScale = d3.scaleLinear()
                         .domain([
                           d3.min(filtered, d => d.Q1),
                           d3.max(filtered, d => d.Q3)
                         ])
                         .range([margin.left, margin.left + width]);

        const yScale = d3.scaleBand()
                         .domain(filtered.map(d => d.Food))
                         .range([margin.top, margin.top + filtered.length * spacing])
                         .padding(0.5);

        const group = svg.append("g");

        // Draw lines (Q1-Q3)
        group.selectAll(".line")
          .data(filtered)
          .enter()
          .append("line")
          .attr("class", "line")
          .attr("x1", d => xScale(d.Q1))
          .attr("x2", d => xScale(d.Q3))
          .attr("y1", d => yScale(d.Food))
          .attr("y2", d => yScale(d.Food))
          .attr("stroke-width", lineThickness);  // Dynamic line thickness

        // Draw median tick
        group.selectAll(".tick")
          .data(filtered)
          .enter()
          .append("line")
          .attr("class", "tick")
          .attr("x1", d => xScale(d.Median))
          .attr("x2", d => xScale(d.Median))
          .attr("y1", d => yScale(d.Food) - lineHeightOffset)  // Adjust starting point for Q2 line
          .attr("y2", d => yScale(d.Food))
          .attr("stroke-width", lineThickness);

        // Add food labels (to the left)
        group.selectAll(".food-label")
          .data(filtered)
          .enter()
          .append("text")
          .attr("class", "food-label")
          .attr("x", d => xScale(d.Median) - 10)  // Positioned left of the line
          .attr("y", d => yScale(d.Food) - lineHeightOffset/2)
          .attr("text-anchor", "end")
          .attr("dominant-baseline", "middle")
          .each(function(d, i) {
            // `this` is the current text element in the loop
            d3.select(this)
              .attr("transform", `skewX(-10) translate(${i / Math.tan(10) * 7} 0)`); // 5 SOON UPDATED
          })
          .text(d => d.Food);

        // Add median labels (to the right)
        group.selectAll(".median-label")
          .data(filtered)
          .enter()
          .append("text")
          .attr("class", "median-label")
          .attr("x", d => xScale(d.Median) + 10)  // Positioned right of the line
          .attr("y", d => yScale(d.Food) - lineHeightOffset/2)
          .attr("text-anchor", "start")
          .attr("dominant-baseline", "middle")
          .each(function(d, i) {
            d3.select(this)
              .attr("transform", `skewX(-10) translate(${i / Math.tan(10) * 8} 0)`); // 5 SOON UPDATED
          })
          .text(d => `${d.Median.toFixed(1)}`);

      }
    });
  </script>
</body>
</html>